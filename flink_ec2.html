<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Flink on EC2</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="extra.css" title="default"/><link rel="stylesheet" type="text/css" href="fancyverb.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x"><span style="font-weight: bold">Flock:<span class="mywbr"> &nbsp;</span> A Serverless Streaming SQL Engine</span></a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="Introduction.html" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right"></td><td><a href="Benchmarks.html" class="tocviewselflink" data-pltdoc="x">Benchmarks</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="Benchmarks.html" class="tocviewlink" data-pltdoc="x">Benchmarks</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="flink_intro.html" class="tocviewlink" data-pltdoc="x">Introduction to Apache Flink</a></td></tr><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Flink on EC2</a></td></tr><tr><td align="right"></td><td><a href="flink_eks.html" class="tocviewlink" data-pltdoc="x">Flink on Amazon EKS</a></td></tr><tr><td align="right"></td><td><a href="flink_kinesis.html" class="tocviewlink" data-pltdoc="x">Amazon Kinesis Data Analytics for Apache Flink</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Flink on EC2</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Install_.Docker_in_.E.C2_.Instance%29" class="tocviewlink" data-pltdoc="x">Install Docker in EC2 Instance</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Install_.Docker-.Compose_in_.E.C2_.Instance%29" class="tocviewlink" data-pltdoc="x">Install Docker-<wbr></wbr>Compose in EC2 Instance</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.How_.To_.Pull_.Docker_.Images_.From_.Amazon_.E.C.R%29" class="tocviewlink" data-pltdoc="x">How To Pull Docker Images From Amazon ECR</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Install_.Docker_in_.E.C2_.Instance%29" class="tocsubseclink" data-pltdoc="x">Install Docker in EC2 Instance</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Install_.Docker-.Compose_in_.E.C2_.Instance%29" class="tocsubseclink" data-pltdoc="x">Install Docker-<wbr></wbr>Compose in EC2 Instance</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.How_.To_.Pull_.Docker_.Images_.From_.Amazon_.E.C.R%29" class="tocsubseclink" data-pltdoc="x">How To Pull Docker Images From Amazon ECR</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.9</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="flink_intro.html" title="backward to &quot;Introduction to Apache Flink&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Benchmarks.html" title="up to &quot;Benchmarks&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="flink_eks.html" title="forward to &quot;Flink on Amazon EKS&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4><a name="(part._flink_ec2)"></a>Flink on EC2</h4><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Install_.Docker_in_.E.C2_.Instance%29" class="toclink" data-pltdoc="x">1<span class="hspace">&nbsp;</span>Install Docker in EC2 Instance</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Install_.Docker-.Compose_in_.E.C2_.Instance%29" class="toclink" data-pltdoc="x">2<span class="hspace">&nbsp;</span>Install Docker-Compose in EC2 Instance</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.How_.To_.Pull_.Docker_.Images_.From_.Amazon_.E.C.R%29" class="toclink" data-pltdoc="x">3<span class="hspace">&nbsp;</span>How To Pull Docker Images From Amazon ECR</a></p></td></tr></table><h5>1<tt>&nbsp;</tt><a name="(part._.Install_.Docker_in_.E.C2_.Instance)"></a>Install Docker in EC2 Instance</h5><p>In this section, we will describe how to deploy a Flink cluster on Amazon EC2. We use a <span style="font-weight: bold">r4.8xlarge</span> instance
to run the Flink cluster. Each instance has 32 threads and 244 GB of memory.</p><p>The first step is to login to the EC2 instance. We use the <span style="font-weight: bold">ssh</span> command to login to the instance.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> -i <span class="st">&quot;xxx.pem&quot;</span> ...compute-1.amazonaws.com</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> authenticity of host <span class="st">&#39;ec2-18-208-228-89.compute-1.amazonaws.com (18.208.228.89)&#39;</span> can<span class="st">&#39;t be established.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">ECDSA key fingerprint is SHA256:/MHCQjLdRmG6AubJo366zoYxYoPWfT0Ie2daqVJSgGM.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">Warning: Permanently added &#39;</span>ec2-18-208-228-89.compute-1.amazonaws.com,18.208.228.89<span class="st">&#39; (ECDSA) to the list of known hosts.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">       __|  __|_  )</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="st">       _|  (     /   Amazon Linux 2 AMI</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">      ___|\___|___|</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="st">https://aws.amazon.com/amazon-linux-2/</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="st">[ec2-user ~]$</span></span></code></pre></div>
</p></blockquote></blockquote><p>Then, we need to install Docker on the instance. We use the <span style="font-weight: bold">sudo</span> command to install Docker.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum update -y</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> amazon-linux-extras install docker -y</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service docker start</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> usermod -a -G docker ec2-user</span></code></pre></div>
</p></blockquote></blockquote><p>But there is one more subtle detail. Every time your Amazon AMI is rebooted, you want the Docker service to remain
up and running. Therefore, we have one final command to use:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable docker</span></code></pre></div>
</p></blockquote></blockquote><p>After this, we can check that the Docker service is running.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> docker ps</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span></code></pre></div>
</p></blockquote></blockquote><h5>2<tt>&nbsp;</tt><a name="(part._.Install_.Docker-.Compose_in_.E.C2_.Instance)"></a>Install Docker-Compose in EC2 Instance</h5><p><span style="font-weight: bold">docker-compose</span> is a very convenient tool to work with. If you have a few Docker images, you quickly get
tired of entering everything via the command line. This is where docker-compose comes in. It allows you to
configure all the images in one place. An application consisting of multiple containers can easily be started
with the command <span style="font-weight: bold">docker-compose up -d</span> and stopped with <span style="font-weight: bold">docker-compose down</span>.</p><p>You can install Docker-Compose using the following commands:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>[<span class="ex">ec2-user</span> ~]$ sudo curl -L <span class="st">&quot;https://github.com/docker/compose/releases/download/v2.2.0/docker-compose-linux-x86_64&quot;</span> -o /usr/local/bin/docker-compose</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">%</span> Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="ex">Dload</span>  Upload   Total   Spent    Left  Speed</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">100</span>   664  100   664    0     0   8623      0 --:--:-- --:--:-- --:--:--  8623</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">100</span> 23.5M  100 23.5M    0     0  44.5M      0 --:--:-- --:--:-- --:--:-- 70.3M</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>[<span class="ex">ec2-user</span> ~]$ sudo chmod +x /usr/local/bin/docker-compose</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>[<span class="ex">ec2-user</span> ~]$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>[<span class="ex">ec2-user</span> ~]$ docker-compose --version</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Docker</span> Compose version v2.2.0</span></code></pre></div>
</p></blockquote></blockquote><p>When you&rsquo;ve done all that, you can choose to append those commands to your user data (without sudo) as well.
Now you&rsquo;ve got docker-compose as a tool available inside EC2!</p><h5>3<tt>&nbsp;</tt><a name="(part._.How_.To_.Pull_.Docker_.Images_.From_.Amazon_.E.C.R)"></a>How To Pull Docker Images From Amazon ECR</h5><p>You&rsquo;ll probably try is to pull a Docker image from Amazon ECR. If you don&rsquo;t configure anything, it will fail.
There are two things you need to fix to make that work.</p><ol><li><p>Select an IAM role. We&rsquo;ll need at least read access to ECR to pull Docker images from a private repository.</p></li><li><p>You need to log into AWS inside your EC2 container.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">aws</span> ecr get-login-password --region us-east-1 <span class="kw">|</span> <span class="ex">docker</span> login --username AWS <span class="kw">\</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--password-stdin</span> XXXXXX.dkr.ecr.us-east-1.amazonaws.com</span></code></pre></div>
</p></blockquote></blockquote></li></ol><p>After that, you successfully set up an EC2 Amazon Machine Image with Docker, docker-compose, and access to Amazon ECR.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="flink_intro.html" title="backward to &quot;Introduction to Apache Flink&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Benchmarks.html" title="up to &quot;Benchmarks&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="flink_eks.html" title="forward to &quot;Flink on Amazon EKS&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>