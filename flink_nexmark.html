<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Nexmark Benchmark for Apache Flink</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="extra.css" title="default"/><link rel="stylesheet" type="text/css" href="fancyverb.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x"><span style="font-weight: bold">Flock:<span class="mywbr"> &nbsp;</span> A Serverless Streaming SQL Engine</span></a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="Introduction.html" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right"></td><td><a href="Benchmarks.html" class="tocviewselflink" data-pltdoc="x">Benchmarks</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="Benchmarks.html" class="tocviewlink" data-pltdoc="x">Benchmarks</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="flink_intro.html" class="tocviewlink" data-pltdoc="x">Introduction to Apache Flink</a></td></tr><tr><td align="right"></td><td><a href="flink_ec2.html" class="tocviewlink" data-pltdoc="x">Flink on EC2</a></td></tr><tr><td align="right"></td><td><a href="flink_eks.html" class="tocviewlink" data-pltdoc="x">Flink on Amazon EKS</a></td></tr><tr><td align="right"></td><td><a href="flink_kinesis.html" class="tocviewlink" data-pltdoc="x">Amazon Kinesis Data Analytics for Apache Flink</a></td></tr><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Nexmark Benchmark for Apache Flink</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Nexmark Benchmark for Apache Flink</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.What_is_.Nexmark%29" class="tocviewlink" data-pltdoc="x">What is Nexmark</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.The_.Queries%29" class="tocviewlink" data-pltdoc="x">The Queries</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Benchmark_.Guideline%29" class="tocviewlink" data-pltdoc="x">Benchmark Guideline</a></td></tr><tr><td align="right"></td><td><a href="#%28part._.References%29" class="tocviewlink" data-pltdoc="x">References</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.What_is_.Nexmark%29" class="tocsubseclink" data-pltdoc="x">What is Nexmark</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.The_.Queries%29" class="tocsubseclink" data-pltdoc="x">The Queries</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Benchmark_.Guideline%29" class="tocsubseclink" data-pltdoc="x">Benchmark Guideline</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Build_.Nexmark%29" class="tocsubseclink" data-pltdoc="x">Build Nexmark</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.Setup_.Flink_.Cluster%29" class="tocsubseclink" data-pltdoc="x">Setup Flink Cluster</a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Run_.Nexmark_.Benchmark%29" class="tocsubseclink" data-pltdoc="x">Run Nexmark Benchmark</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.References%29" class="tocsubseclink" data-pltdoc="x">References</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.9</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="flink_kinesis.html" title="backward to &quot;Amazon Kinesis Data Analytics for Apache Flink&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Benchmarks.html" title="up to &quot;Benchmarks&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h4><a name="(part._flink_nexmark)"></a>Nexmark Benchmark for Apache Flink</h4><h5>1<tt>&nbsp;</tt><a name="(part._.What_is_.Nexmark)"></a>What is Nexmark</h5><p>Nexmark is a benchmark suite for queries over continuous data streams. This benchmark is inspired by
the <a href="https://web.archive.org/web/20100620010601/http://datalab.cs.pdx.edu/niagaraST/NEXMark/">NEXMark research paper</a> and Apache Beam.</p><p>These are multiple queries over a three entities model representing on online auction system:</p><ul><li><p><span style="font-weight: bold">Person</span> represents a person submitting an item for auction and/or making a bid on an auction.</p></li><li><p><span style="font-weight: bold">Auction</span> represents an item under auction.</p></li><li><p><span style="font-weight: bold">Bid</span> represents a bid for an item under auction.</p></li></ul><h5>2<tt>&nbsp;</tt><a name="(part._.The_.Queries)"></a>The Queries</h5><p><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;" colspan="5"><p><span style="font-weight: bold">Nexmark Benchmark Suite</span></p></td></tr><tr><td><p><span style="font-weight: bold">Query</span></p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p><span style="font-weight: bold">Name</span></p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p><span style="font-weight: bold">Summary</span></p></td></tr><tr><td><p>q0</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Pass Through</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Measures the monitoring overhead including the source generator.</p></td></tr><tr><td><p>q1</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Currency Conversion</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Convert each bid value from dollars to euros.</p></td></tr><tr><td><p>q2</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Selection</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Find bids with specific auction ids and show their bid price.</p></td></tr><tr><td><p>q3</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Local Item Suggestion</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Who is selling in OR, ID or CA in category 10, and for what auction ids?</p></td></tr><tr><td><p>q4</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Average Price for a Category</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Select the average of the wining bid prices for all auctions in each category.</p></td></tr><tr><td><p>q5</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Hot Items</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Which auctions have seen the most bids in the last period?</p></td></tr><tr><td><p>q6</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Average Selling Price by Seller</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>What is the average selling price per seller for their last 10 closed auctions.</p></td></tr><tr><td><p>q7</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Highest Bid</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Select the bids with the highest bid price in the last period.</p></td></tr><tr><td><p>q8</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Monitor New Users</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Select people who have entered the system and created auctions in the last period.</p></td></tr><tr><td><p>q9</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Winning Bids</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Find the winning bid for each auction.</p></td></tr><tr><td><p>q10</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Log to File System</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Log all events to file system. Illustrates windows streaming data into partitioned file system.</p></td></tr><tr><td><p>q11</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>User Sessions</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>How many bids did a user make in each session they were active? Illustrates session windows.</p></td></tr><tr><td><p>q12</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Processing Time Windows</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>How many bids does a user make within a fixed processing time limit? Illustrates working in processing time window.</p></td></tr><tr><td><p>q13</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Bounded Side Input Join</p></td><td><p><span class="hspace">&nbsp;&nbsp;</span></p></td><td><p>Joins a stream to a bounded side input, modeling basic stream enrichment.</p></td></tr></table></p><p><span class="emph">q1 ~ q8 are from original NEXMark queries, q9 ~ q13 are from Apache Beam.</span></p><h5>3<tt>&nbsp;</tt><a name="(part._.Benchmark_.Guideline)"></a>Benchmark Guideline</h5><p>The Nexmark benchmark framework runs Flink queries on standalone cluster (Session Mode). The cluster should consist of
one master node and one or more worker nodes. All of them should be Linux environment (the CPU monitor script requries to
run on Linux). Please make sure you have the following software installed on each node:</p><ul><li><p>JDK 1.8.x or higher (Nexmark scripts uses some tools of JDK)</p></li><li><p>ssh (sshd must be running to use the Flink and Nexmark scripts that manage remote components)</p></li></ul><p>Having <a href="https://linuxize.com/post/how-to-setup-passwordless-ssh-login/"></a>(passwordless SSH) and the same directory structure
on all your cluster nodes will allow you to use our scripts to control everything.</p><h5>3.1<tt>&nbsp;</tt><a name="(part._.Build_.Nexmark)"></a>Build Nexmark</h5><p>Before start to run the benchmark, you should build the Nexmark benchmark first to have a benchmark package.
Please make sure you have installed maven in your build machine. And run the emph{./build.sh} command under nexmark-flink directoy.
Then you will get the nexmark-flink.tgz archive under the directory.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">git</span> clone https://github.com/nexmark/nexmark</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">cd</span> nexmark-flink</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>[<span class="ex">nexmark-flink</span> ~] mvn package -DskipTests</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>[<span class="ex">nexmark-flink</span> ~] ls target/</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">nexmark-flink-0.2-SNAPSHOT.jar</span>  original-nexmark-flink-0.2-SNAPSHOT.jar</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>[<span class="ex">nexmark-flink</span> ~] ls</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">build.sh*</span>  nexmark-flink.tgz  pom.xml  src/  target/</span></code></pre></div>
</p></blockquote></blockquote><h5>3.2<tt>&nbsp;</tt><a name="(part._.Setup_.Flink_.Cluster)"></a>Setup Flink Cluster</h5><ol><li><p><div class="SIntrapara">Download the latest Flink package from the download page.
</div><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">wget</span> https://dlcdn.apache.org/flink/flink-1.13.3/flink-1.13.3-bin-scala_2.12.tgz --no-check-certificate</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> xzf flink-1.13.3-bin-scala_2.12.tgz<span class="kw">;</span> <span class="fu">tar</span> xzf nexmark-flink.tgz</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">mv</span> flink-1.13.3 flink<span class="kw">;</span> <span class="fu">mv</span> nexmark-flink nexmark</span></code></pre></div>
</p></blockquote></blockquote></div></p></li><li><p>Copy the jars under <span class="emph">nexmark/lib</span> to <span class="emph">flink/lib</span> which contains the Nexmark source generator.</p></li><li><p><div class="SIntrapara">Configure Flink
</div><div class="SIntrapara"><ul><li><p>Edit <span class="emph">flink/conf/workers</span> and enters the IP address of each worker node. Recommand to set 8 entries.</p></li><li><p>Replace <span class="emph">flink/conf/sql-client-defaults.yaml</span> by <span class="emph">nexmark/conf/sql-client-defaults.yaml</span></p></li><li><p><div class="SIntrapara">Replace <span class="emph">flink/conf/flink-conf.yaml</span> by <span class="emph">nexmark/conf/flink-conf.yaml</span>. Remember to update the following configurations:
</div><div class="SIntrapara"><ul><li><p>Set <span class="emph">jobmanager.rpc.address</span> to you master IP address</p></li><li><p>Set <span class="emph">state.checkpoints.dir</span> to your local file path (recommend to use SSD), e.g. <span class="emph">file:///home/username/checkpoint</span>.</p></li><li><p>Set <span class="emph">state.backend.rocksdb.localdir</span> to your local file path (recommend to use SSD), e.g. <span class="emph">/home/username/rocksdb</span>.</p></li></ul></div></p></li></ul></div></p></li><li><p>Configure Nexmark benchmark. Set <span class="emph">nexmark.metric.reporter.host</span> in <span class="emph">nexmark/conf/nexmark.yaml</span> to your master IP address.</p></li><li><p>Copy <span class="emph">flink</span> and <span class="emph">nexmark</span> folders to your worker nodes using <span class="emph">scp</span>.</p></li><li><p>Start Flink Cluster by running <span class="emph">flink/bin/start-cluster.sh</span> on the master node.</p></li><li><p>Start Nexmark benchmark by running <span class="emph">nexmark/bin/setup_cluster.sh</span> on the master node.</p></li></ol><h5>3.3<tt>&nbsp;</tt><a name="(part._.Run_.Nexmark_.Benchmark)"></a>Run Nexmark Benchmark</h5><p>You can run the Nexmark benchmark by running <span class="emph">nexmark/bin/run_query.sh all</span> on the master node.
It will run all the queries one by one, and collect benchmark metrics automatically. It will take 50 minutes
to finish the benchmark by default. At last, it will print the benchmark summary result (Cores * Time(s)
for each query) on the console. You can also run specific queries by running the following command:</p><blockquote class="SCentered"><p>nexmark/bin/run_query.sh q1,q2</p></blockquote><p>You can also tune the workload of the queries by editing <span class="emph">nexmark/conf/nexmark.yaml</span> with the
<span class="emph">nexmark.workload.*</span> prefix options.</p><h5><a name="(part._.References)"></a>References</h5><ol><li><p>Pete Tucker, Kristin Tufte, Vassilis Papadimos, David Maier. NEXMark &#8211; A Benchmark for Queries over Data Streams. June 2010.</p></li><li><p>Apache Beam, <a href="https://beam.apache.org/">https://beam.apache.org/</a></p></li><li><p>Nexmark, <a href="https://web.archive.org/web/20100620010601/http://datalab.cs.pdx.edu/niagaraST/NEXMark/">https://web.archive.org/web/20100620010601/http://datalab.cs.pdx.edu/niagaraST/NEXMark/</a></p></li><li><p>Nexmark Benchmark Suite, <a href="https://github.com/nexmark/nexmark">https://github.com/nexmark/nexmark</a></p></li></ol><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="flink_kinesis.html" title="backward to &quot;Amazon Kinesis Data Analytics for Apache Flink&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Benchmarks.html" title="up to &quot;Benchmarks&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>